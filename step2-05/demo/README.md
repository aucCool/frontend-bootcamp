# Шаг 2.5 - Redux: Магазин (Демонстрация)
[Уроки](../../) | [Упражнение](../упражнение/)

На этом шаге мы рассмотрим решение проблем сложных приложений (как упоминалось в Шаге 4) с помощью библиотеки под названием [Redux](https://redux.js.org).

1. Введение в Redux
2. Зачем использовать Redux?
3. Создание магазина Redux
4. Пишущие редукторы
5. Диспетчерские действия

## Введение в Redux

Напомним, что проблемы, которые мы хотим решить, заключаются в следующем:

1. Данные должны передаваться от компонента к компоненту с помощью реквизитов, даже если некоторые промежуточные компоненты не используют все данные.
2. Общие данные могут быть изменены различными участниками (взаимодействие с пользователем, обновления с сервера), и координация этих изменений отсутствует.

Redux-это реализация архитектурного шаблона Flux:

![Flux Diagram](../../assets/flux.png)

### Представление 

Представление-это компонент React, который использует хранилище в качестве своих данных.

### Действия

[Действия](https://redux.js.org/basics/actions) являются сериализуемыми сообщениями текстового формата обмена данными, которые представляют какое-либо событие, такое как действие пользователя или сетевой запрос. С помощью **редукторов** они влияют на общее состояние. Как минимум, действие должно содержать ключ " тип`. Иногда он содержит дополнительные данные в виде **полезной нагрузки**.

### Магазин

В [магазине](https://redux.js.org/basics/store) состоит из **дерева состояний**, **диспетчера** и **редукторов**.

1. Дерево состояний *** представляет собой вложенную структуру текстового формата обмена данными _singleton_, _serializable_, _immutable_. Он обновляется от одного снимка к другому с помощью редукторов.

2. [**диспетчер**](https://redux.js.org/basics/data-flow) принимает действия, передавая их редукторам.

3. [**Редукторы**](https://redux.js.org/basics/reducers) - это функции, которые выполняют текущее дерево состояний и действие, создающее следующий снимок дерева состояний. Это единственный способ обновить дерево состояний.

## Зачем использовать Redux?

Существует множество доступных альтернатив, но вот несколько действительно веских причин, чтобы пойти с Redux:

1. Для более сложных приложений шаблон потока заставляет код быть написанным таким образом, чтобы о нем было легко рассуждать
2. Может возникнуть необходимость в сериализации состояния приложения, которое каким-либо образом будет передаваться по сети
3. Инструменты для разработки действительно потрясающие
4. Популярность фреймворка означает, что на данный момент экосистема является зрелой

## Использование Redux

### Создание магазина Redux

[`создать хранилище()`](https://redux.js.org/api/createstore) функция предоставляется Redux для создания магазина. Как правило, приложение имеет один магазин. Функция обычно использует основной редуктор и начальный снимок дерева состояний.

```ts
const store = createStore(reducer, initialState);
```

### Редукторы записи

Мы напишем наши редукторы с помощью некоторых утилит из официального [`redux-starter-kit`](https://redux-starter-kit.js.org/), что значительно уменьшает количество необходимых шаблонов. Процесс проектирования и внедрения редукторов заключается в следующем:

#### 1. Организуйте редукторы в соответствии с ключами объекта дерева состояний

Учитывая дерево состояний, имеющее такую форму:

```ts
{
  todos: {
    [id: string]: TodoItem,
  },

  filter: 'all' | 'complete' | 'active'
}
```
Мы  организовали наши редукторы, соответствующие ключам дерева состояний, и объединили их с [`combineReducers()`](https://redux.js.org/recipes/structuring-reducers/using-combinereducers):

```ts
import { createReducer } from 'redux-starter-kit';
import { combineReducers } from 'redux';

const reducer = combineReducers({
  todos: createReducer({}, {
    addTodo: (state, action) => { /* ... */ }
  }),
  filter: createReducer('all', {
    setFilter: (state, action) => { /* ... */ }
  })
})
```

#### 2. Напишите редукторы с изменяемыми параметрами

В обычном редакторе редукторы должны сделать копию состояния перед внесением изменений, но [`createReducer()`](https://redux-starter-kit.js.org/api/createreducer) автоматически переведет все мутации в состояние в неизменяемые моментальные снимки (!!!!!):

```ts
// first argument: initial state
// second argument: object whose keys correspond to possible values of action.type
const todosReducer = createReducer(
  {},
  {
    addTodo: (state, action) => {
      state[action.id] = { label: action.label, completed: false };
    }
  }
);
```

### Диспетчерские действия

Отправка действия передаст действие и текущее состояние редукторам. Корневой редуктор создаст новый снимок всего дерева состояний. Мы можем проверить затронутый снимок с помощью `getState()`.

```ts
const store = createStore(reducer, initialState);
store.dispatch({ type: 'addTodo', label: 'hello' });
store.dispatch({ type: 'addTodo', label: 'world' });
console.log(store.getState());
```
Создавать эти сообщения о действиях вручную утомительно, поэтому мы используем для этого создателей действий:

```ts
const actions = {
  addTodo = (label: string) => ({ label, id: nextId(), completed: false })
};

store.dispatch(actions.addTodo('hello'));
```
